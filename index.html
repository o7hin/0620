<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI æ™ºæ…§é£Ÿè­œèˆ‡å‰µæ„èª¿é…’ç³»çµ±</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ³ AI æ™ºæ…§é£Ÿè­œèˆ‡èª¿é…’ç³»çµ±</h1>
            <p>é€éè¼¸å…¥é£Ÿæã€é ç®—èˆ‡ç†±é‡ï¼Œç²å¾—å€‹äººåŒ–é£Ÿè­œèˆ‡èª¿é…’æ¨è–¦</p>
        </header>

        <main>
            <!-- Google API è¨­å®šå€åŸŸ -->
            <section class="api-settings-section" style="border: 2px solid #e3f2fd; border-radius: 10px; padding: 15px; margin: 20px 0; background-color: #f8f9fa;">
                <h3 style="color: #1976D2; margin-top: 0;">ğŸ”‘ Google API è¨­å®š</h3>
                <div class="api-controls" style="display: flex; align-items: center; gap: 15px;">
                    <button id="setApiKeyBtn" class="btn" style="background-color: #2196F3; color: white; padding: 12px 20px; border: none; border-radius: 4px; font-size: 16px; cursor: pointer; font-weight: bold; box-shadow: 0 2px 5px rgba(0,0,0,0.2);">
                        <i class="fas fa-key"></i> è¨­å®š Google API Key
                    </button>
                    <div id="apiKeyStatus" class="status-indicator" style="padding: 6px 12px; border-radius: 20px; background-color: #f1f1f1; font-weight: bold;">æœªè¨­å®š</div>
                </div>
                <p class="api-info" style="margin-top: 10px; color: #666; font-style: italic;"><small>è¨­å®š Google API Key ä»¥ç²å–æ›´å€‹æ€§åŒ–çš„é£Ÿè­œå’Œèª¿é…’å»ºè­°</small></p>
            </section>
            
            <!-- Arduino é€£æ¥å€åŸŸ -->
            <section class="arduino-section" style="border: 2px solid #fff3cd; border-radius: 10px; padding: 15px; margin: 20px 0; background-color: #fefefe;">
                <h3 style="color: #e67e22; margin-top: 0;">ğŸ›ï¸ Arduino é€£æ¥</h3>
                <div class="arduino-controls">
                    <button id="connectArduinoBtn" class="btn btn-secondary">
                        <i class="fas fa-plug"></i> é€£æ¥ Arduino è£ç½®
                    </button>
                    <div id="arduinoStatus" class="status-indicator">æœªé€£æ¥</div>
                </div>
                <div class="arduino-actions">
                    <button id="sendToArduinoBtn" class="btn btn-secondary" disabled>
                        <i class="fas fa-paper-plane"></i> å‚³é€è‡³ Arduino
                    </button>
                    <button id="testLightsBtn" class="btn btn-secondary" disabled>
                        <i class="fas fa-lightbulb"></i> æ¸¬è©¦ç‡ˆæ³¡
                    </button>
                    <button id="resetLightsBtn" class="btn btn-secondary" disabled>
                        <i class="fas fa-power-off"></i> é‡ç½®ç‡ˆæ³¡
                    </button>
                </div>
                <p style="margin-top: 10px; color: #666; font-style: italic;"><small>é€£æ¥ Arduino ä½¿ç”¨æŒ‰éˆ•æ§åˆ¶é›£åº¦é¸æ“‡ï¼ŒLED ç‡ˆæœƒé¡¯ç¤ºç•¶å‰é›£åº¦ç‹€æ…‹</small></p>
            </section>
            
            <!-- ä¸»è¦åŠŸèƒ½è¼¸å…¥å€åŸŸ -->
            <section class="input-section">
                <div class="input-group">
                    <h3>é£Ÿç‰©éœ€æ±‚</h3>
                    <input type="text" id="foodRequirementsInput" placeholder="ä¾‹å¦‚ï¼šé›è‚‰ã€è”¬èœã€ä¸­å¼æ–™ç†ã€ä¸è¦å¤ªè¾£ã€å®¶å¸¸èœ...">
                </div>
                <div class="input-group">
                    <h3>é ç®—</h3>
                    <input type="number" id="budgetInput" placeholder="ä¾‹å¦‚ï¼š200å…ƒ">
                </div>
                <div class="input-group">
                    <h3>ç†±é‡ä¸Šé™</h3>
                    <input type="number" id="caloriesInput" placeholder="ä¾‹å¦‚ï¼š500å¤§å¡">
                </div>
                <input type="hidden" id="ingredientsInput">
            </section>

            <!-- é›£åº¦é¸æ“‡å€åŸŸ -->
            <section class="difficulty-section">
                <h3>é¸æ“‡é›£åº¦ - Arduino æŒ‰éˆ•æ§åˆ¶</h3>
                <p style="color: #666; margin-bottom: 15px; font-size: 14px;">ğŸ›ï¸ ä½¿ç”¨Arduinoä¸Šçš„æŒ‰éˆ•é¸æ“‡çƒ¹é£ªé›£åº¦ï¼Œæˆ–é»æ“Šä¸‹æ–¹æŒ‰éˆ•ï¼ˆéœ€å…ˆé€£æ¥Arduinoï¼‰</p>
                <div class="difficulty-buttons">
                    <button id="easyBtn" class="difficulty-btn easy">ç°¡å–® <span class="difficulty-icon">âšª</span></button>
                    <button id="mediumBtn" class="difficulty-btn medium">ä¸­ç­‰ <span class="difficulty-icon">ğŸŸ¢</span></button>
                    <button id="hardBtn" class="difficulty-btn hard">å›°é›£ <span class="difficulty-icon">ğŸ”´</span></button>
                </div>
                <div class="arduino-difficulty-info" style="background-color: #fff3cd; border: 1px solid #ffeaa7; border-radius: 5px; padding: 10px; margin: 10px 0; font-size: 14px;">
                    <p style="margin: 0; color: #856404;"><strong>ğŸ’¡ Arduinoæ§åˆ¶èªªæ˜ï¼š</strong></p>
                    <ul style="margin: 5px 0; padding-left: 20px; color: #856404;">
                        <li>æŒ‰ä¸‹Arduinoä¸Šçš„åˆ‡æ›æŒ‰éˆ•ä¾†å¾ªç’°é¸æ“‡é›£åº¦</li>
                        <li>LEDç‡ˆæœƒé»äº®é¡¯ç¤ºç•¶å‰é¸æ“‡çš„é›£åº¦</li>
                        <li>ç¶²é æŒ‰éˆ•åƒ…ä½œç‚ºç‹€æ…‹é¡¯ç¤ºï¼Œä¸»è¦ç”±Arduinoæ§åˆ¶</li>
                    </ul>
                </div>
                <button id="confirmBtn" class="btn btn-confirm">ğŸ³ ç”Ÿæˆé£Ÿè­œ</button>
                <button onclick="window.debugInputs()" style="margin-left: 10px; padding: 8px 16px; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer;">ğŸ” èª¿è©¦è¼¸å…¥</button>
                <button onclick="window.testRecipeGeneration()" style="margin-left: 10px; padding: 8px 16px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer;">ğŸ§ª æ¸¬è©¦ç”Ÿæˆ</button>
                <button onclick="window.diagnoseDifficultySync()" style="margin-left: 10px; padding: 8px 16px; background: #17a2b8; color: white; border: none; border-radius: 4px; cursor: pointer;">ğŸ”§ è¨ºæ–·é›£åº¦åŒæ­¥</button>
                <button onclick="window.createDifficultyDebugger()" style="margin-left: 10px; padding: 8px 16px; background: #6f42c1; color: white; border: none; border-radius: 4px; cursor: pointer;">ğŸ› ï¸ é–‹å•Ÿèª¿è©¦é¢æ¿</button>
            </section>
            
            <!-- é¡¯ç¤ºå€åŸŸ -->
            <section class="display-section">
                <p style="color: #666; margin-bottom: 15px; font-size: 14px; text-align: center;">é»æ“Šä¸‹æ–¹æ¨™ç±¤ä¾†åˆ‡æ›é£Ÿè­œå»ºè­°æˆ–ç”Ÿæˆèª¿é…’é…æ–¹</p>
                <div class="tabs">
                    <button id="recipeTabBtn" class="tab-btn active">ğŸ³ é£Ÿè­œå»ºè­°</button>
                    <button id="cocktailTabBtn" class="tab-btn">ğŸ¹ ä¾¿åˆ©å•†åº—èª¿é…’</button>
                </div>
                
                <div id="recipeContent" class="tab-content active">
                    <div class="recipe-card">
                        <h2 id="recipeName">å°šæœªç”Ÿæˆé£Ÿè­œ</h2>
                        <div class="shopping-list-section">
                            <h3>è³¼è²·æ¸…å–®</h3>
                            <div class="shopping-list-container">
                                <ul id="shoppingList"></ul>
                            </div>
                        </div>
                        <div class="recipe-info">
                            <div class="recipe-detail">
                                <h4>æ‰€éœ€é£Ÿæ</h4>
                                <ul id="recipeIngredients"></ul>
                            </div>
                            <div class="recipe-detail">
                                <h4>çƒ¹é£ªæ­¥é©Ÿ</h4>
                                <ol id="recipeSteps"></ol>
                            </div>
                            <div class="recipe-stats">
                                <div class="stat">
                                    <span class="stat-label">é ç®—</span>
                                    <span id="recipeBudget" class="stat-value">--</span>
                                </div>
                                <div class="stat">
                                    <span class="stat-label">ç†±é‡</span>
                                    <span id="recipeCalories" class="stat-value">--</span>
                                </div>
                                <div class="stat">
                                    <span class="stat-label">é›£åº¦</span>
                                    <span id="recipeDifficulty" class="stat-value">--</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div id="cocktailContent" class="tab-content">
                    <div class="cocktail-card">
                        <h2 id="cocktailName">å°šæœªç”Ÿæˆä¾¿åˆ©å•†åº—èª¿é…’</h2>
                        <div class="cocktail-info">
                            <div class="cocktail-detail">
                                <h4>ææ–™ï¼ˆä¾¿åˆ©å•†åº—å¯è³¼è²·ï¼‰</h4>
                                <ul id="cocktailIngredients"></ul>
                            </div>
                            <div class="cocktail-detail">
                                <h4>è£½ä½œæ–¹æ³•</h4>
                                <ol id="cocktailSteps"></ol>
                            </div>
                            <div class="cocktail-stats">
                                <div class="stat">
                                    <span class="stat-label">é¢¨æ ¼</span>
                                    <span id="cocktailStyle" class="stat-value">--</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <footer>
            <p>AI æ™ºæ…§èªéŸ³äº’å‹•é£Ÿè­œèˆ‡å‰µæ„èª¿é…’ç³»çµ± | &copy; 2025</p>
        </footer>
    </div>

    <!-- å¼•å…¥ Google Generative AI SDK - ä½¿ç”¨æœ¬åœ° UMD ç‰ˆæœ¬ -->
    <script src="js/index.umd.js"></script>
    
    <!-- å…§åµŒç‰ˆ SDK (ä½œç‚ºå‚™ç”¨) -->
    <script src="js/gemini-sdk-embedded.js"></script>
    
    <!-- ä¸»è¦ JavaScript æª”æ¡ˆ -->
    <script src="js/input-handler.js"></script>
    <script src="js/gemini-service.js"></script>
    <script src="js/arduino-service.js"></script>
    <script src="js/recipe-generator.js"></script>
    <script src="js/cocktail-generator-clean.js"></script>
    <script src="js/main.js"></script>
    
    <!-- ç¢ºä¿æ‰‹å‹•è¼¸å…¥åŠŸèƒ½èˆ‡ API Key æ­£å¸¸åˆå§‹åŒ– -->
    <script>
        // ç¢ºä¿æ‰‹å‹•è¼¸å…¥è™•ç†å™¨å’Œ API Key åœ¨é é¢åŠ è¼‰æ™‚æ­£ç¢ºåˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            // æª¢æŸ¥æ‰‹å‹•è¼¸å…¥è™•ç†å™¨æ˜¯å¦æ­£ç¢ºåˆå§‹åŒ–
            if (!window.speechRecognitionInstance) {
                console.log('åˆå§‹åŒ–æ‰‹å‹•è¼¸å…¥è™•ç†å™¨...');
                window.speechRecognitionInstance = new ManualInputHandler();
            }
            
            // é¡¯ç¤ºå·²åˆå§‹åŒ–è¨Šæ¯ï¼Œæ–¹ä¾¿ç¢ºèª
            console.log('âœï¸ æ‰‹å‹•è¼¸å…¥è™•ç†å™¨åˆå§‹åŒ–å®Œæˆ');
            
            // æª¢æŸ¥æ˜¯å¦å·²æœ‰ API Key ä¸¦æ›´æ–°ç‹€æ…‹é¡¯ç¤º
            const savedApiKey = localStorage.getItem('googleApiKey');
            const apiKeyStatus = document.getElementById('apiKeyStatus');
            
            if (savedApiKey && apiKeyStatus) {
                console.log('æª¢æ¸¬åˆ°å·²ä¿å­˜çš„ API Key');
                apiKeyStatus.innerHTML = '<i class="fas fa-check-circle"></i> å·²é€£æ¥';
                apiKeyStatus.classList.add('connected');
                apiKeyStatus.style.backgroundColor = '#e8f5e9';
                apiKeyStatus.style.color = '#2e7d32';
                apiKeyStatus.style.border = '1px solid #2e7d32';
                
                // æ›´æ–°è¨­å®šæŒ‰éˆ•
                const setApiKeyBtn = document.getElementById('setApiKeyBtn');
                if (setApiKeyBtn) {
                    setApiKeyBtn.innerHTML = '<i class="fas fa-edit"></i> é‡æ–°è¨­å®š API Key';
                    setApiKeyBtn.style.backgroundColor = '#4CAF50';
                }
            }
            
            // æ‰‹å‹•è§¸ç™¼æ¨¡æ…‹æ¡†çš„åŠŸèƒ½ï¼ˆæ¸¬è©¦ç”¨ï¼‰
            window.showApiKeyModal = function() {
                console.log('æ‰‹å‹•è§¸ç™¼ API Key æ¨¡æ…‹æ¡†');
                promptForApiKey().then(apiKey => {
                    console.log('ç²å–åˆ° API Key:', apiKey ? 'å·²å¡«å¯«' : 'æœªå¡«å¯«');
                    if (apiKey) {
                        alert('æ‚¨è¼¸å…¥çš„ API Key: ' + (apiKey === 'MOCK_API_KEY_FOR_DEMO' ? 'ä½¿ç”¨æ¨¡æ“¬æ•¸æ“š' : apiKey.substring(0, 10) + '...'));
                    } else {
                        alert('ç”¨æˆ¶å–æ¶ˆæˆ–æœªè¼¸å…¥ API Key');
                    }
                });
            };
            
            // å‰µå»ºå¢å¼·ç‰ˆè¨ºæ–·æŒ‰éˆ•ï¼Œå”åŠ©æ’æŸ¥ API å•é¡Œ
            const diagBtn = document.createElement('button');
            diagBtn.id = 'diagApiBtn';
            diagBtn.innerHTML = 'ğŸ” è¨ºæ–· API å•é¡Œ';
            diagBtn.style = 'position: fixed; bottom: 10px; left: 10px; z-index: 9999; background: linear-gradient(to right, #e3f2fd, #bbdefb); border: 1px solid #1976D2; padding: 8px 15px; border-radius: 20px; font-size: 14px; opacity: 0.9; font-weight: bold; color: #0d47a1; box-shadow: 0 3px 8px rgba(0,0,0,0.2); transition: all 0.3s ease; display: flex; align-items: center; gap: 5px;';
            
            // æ·»åŠ è„ˆå‹•æ•ˆæœï¼Œä½¿æŒ‰éˆ•æ›´å®¹æ˜“è¢«æ³¨æ„åˆ°
            let pulseAnimation = false;
            if (!window.geminiServiceInstance?.isInitialized()) {
                // å¦‚æœ API æœªæ­£ç¢ºåˆå§‹åŒ–ï¼Œæ·»åŠ è„ˆå‹•æ•ˆæœ
                pulseAnimation = true;
                diagBtn.style.animation = 'pulse 2s infinite';
                
                // æ·»åŠ  CSS å‹•ç•«
                const style = document.createElement('style');
                style.textContent = `
                    @keyframes pulse {
                        0% { box-shadow: 0 0 0 0 rgba(33, 150, 243, 0.7); }
                        70% { box-shadow: 0 0 0 10px rgba(33, 150, 243, 0); }
                        100% { box-shadow: 0 0 0 0 rgba(33, 150, 243, 0); }
                    }
                `;
                document.head.appendChild(style);
            }
            
            // æ‡¸åœæ•ˆæœ
            diagBtn.onmouseenter = function() {
                this.style.transform = 'scale(1.05)';
                this.style.boxShadow = '0 5px 12px rgba(0,0,0,0.25)';
            };
            
            diagBtn.onmouseleave = function() {
                this.style.transform = 'scale(1)';
                this.style.boxShadow = '0 3px 8px rgba(0,0,0,0.2)';
            };
            
            // é»æ“Šæ•ˆæœå•Ÿå‹•é€²éšè¨ºæ–·
            diagBtn.onclick = async function() {
                // é¡¯ç¤ºè¼‰å…¥æŒ‡ç¤ºå™¨
                this.innerHTML = 'â³ è¨ºæ–·ä¸­...';
                this.style.pointerEvents = 'none'; // é˜²æ­¢é‡è¤‡é»æ“Š
                
                try {
                    // ç•°æ­¥åŸ·è¡Œè¨ºæ–·
                    await diagnosisApiIssue();
                    
                    // è¨ºæ–·å®Œæˆå¾Œæ¢å¾©æŒ‰éˆ•
                    this.innerHTML = 'ğŸ” è¨ºæ–· API å•é¡Œ';
                    this.style.pointerEvents = 'auto';
                } catch (err) {
                    console.error('è¨ºæ–·éç¨‹ç™¼ç”ŸéŒ¯èª¤:', err);
                    this.innerHTML = 'ğŸ” è¨ºæ–· API å•é¡Œ';
                    this.style.pointerEvents = 'auto';
                    alert('è¨ºæ–·éç¨‹ç™¼ç”ŸéŒ¯èª¤: ' + err.message);
                }
            };
            
            document.body.appendChild(diagBtn);
            
            // ç³»çµ±è¨ºæ–·æŒ‰éˆ• - å¯è¨ºæ–·æ›´å»£æ³›çš„å•é¡Œ
            const diagBtnStyle = 'position: fixed; z-index: 9999; background: linear-gradient(to right, #e3f2fd, #bbdefb); border: 1px solid #1976D2; padding: 8px 15px; border-radius: 20px; font-size: 14px; opacity: 0.9; font-weight: bold; color: #0d47a1; box-shadow: 0 3px 8px rgba(0,0,0,0.2); transition: all 0.3s ease; display: flex; align-items: center; gap: 5px;';
            
            const diagSystemBtn = document.createElement('button');
            diagSystemBtn.id = 'diagSystemBtn';
            diagSystemBtn.innerHTML = 'ğŸ› ï¸ ç³»çµ±è¨ºæ–·';
            diagSystemBtn.style = diagBtnStyle + 'bottom: 10px; left: 165px; background: linear-gradient(to right, #fff0c7, #ffe082);';
            
            diagSystemBtn.onmouseenter = function() {
                this.style.transform = 'scale(1.05)';
                this.style.boxShadow = '0 5px 12px rgba(0,0,0,0.25)';
            };
            
            diagSystemBtn.onmouseleave = function() {
                this.style.transform = 'scale(1)';
                this.style.boxShadow = '0 3px 8px rgba(0,0,0,0.2)';
            };
            
            diagSystemBtn.onclick = function() {
                this.innerHTML = 'â³ è¨ºæ–·ä¸­...';
                this.style.pointerEvents = 'none';
                
                try {
                    // èª¿ç”¨å…¨å±€è¨ºæ–·å‡½æ•¸
                    window.diagnoseSystem();
                    
                    this.innerHTML = 'ğŸ› ï¸ ç³»çµ±è¨ºæ–·';
                    this.style.pointerEvents = 'auto';
                } catch (err) {
                    console.error('ç³»çµ±è¨ºæ–·ç™¼ç”ŸéŒ¯èª¤:', err);
                    this.innerHTML = 'ğŸ› ï¸ ç³»çµ±è¨ºæ–·';
                    this.style.pointerEvents = 'auto';
                    alert('ç³»çµ±è¨ºæ–·ç™¼ç”ŸéŒ¯èª¤: ' + err.message);
                }
            };
            
            document.body.appendChild(diagSystemBtn);
            
            // å¦‚æœæœ‰éŒ¯èª¤æç¤ºæˆ–è¶…æ™‚ï¼Œè‡ªå‹•è§¸ç™¼ä¸€æ¬¡è¨ºæ–·
            if (pulseAnimation) {
                // å»¶é²ä¸€é»æ™‚é–“å†åŸ·è¡Œï¼Œè®“é é¢å…ˆè¼‰å…¥å®Œç•¢
                setTimeout(() => {
                    console.log('æª¢æ¸¬åˆ° API ç‹€æ…‹ç•°å¸¸ï¼Œè‡ªå‹•åŸ·è¡Œè¨ºæ–·...');
                    // ç¢ºä¿ showNotification å‡½æ•¸å·²è¼‰å…¥
                    if (typeof showNotification === 'function') {
                        showNotification('ğŸ’¡ ç³»çµ±åµæ¸¬åˆ° API å¯èƒ½æœ‰å•é¡Œï¼Œæ­£åœ¨è‡ªå‹•è¨ºæ–·...', 'info');
                    }
                    // ç¢ºä¿ diagnosisApiIssue å‡½æ•¸å·²è¼‰å…¥
                    if (typeof diagnosisApiIssue === 'function') {
                        diagnosisApiIssue();
                    }
                }, 5000);
            }
            
            // æ·»åŠ ä¸€å€‹æ¨¡æ…‹æ¡†æ¸¬è©¦æŒ‰éˆ•ï¼ˆä¾¿æ–¼æ¸¬è©¦ï¼‰
            const testModalBtn = document.createElement('button');
            testModalBtn.id = 'testModalBtn';
            testModalBtn.innerHTML = 'ğŸ§ª æ¸¬è©¦ Google API Key æ¨¡æ…‹æ¡†';
            testModalBtn.style = 'position: fixed; bottom: 60px; left: 10px; z-index: 9999; background: #FF9800; color: white; border: 1px solid #F57C00; padding: 8px 12px; border-radius: 4px; font-size: 12px; cursor: pointer; font-weight: bold; box-shadow: 0 2px 5px rgba(0,0,0,0.2);';
            
            testModalBtn.addEventListener('click', () => {
                console.log('æ¸¬è©¦æŒ‰éˆ•è¢«é»æ“Š');
                window.showApiKeyModal();
            });
            
            document.body.appendChild(testModalBtn);
        });
        
        // æ·»åŠ å…§åµŒèª¿è©¦å·¥å…·
        window.createDifficultyDebugger = function() {
            const debugPanel = document.createElement('div');
            debugPanel.id = 'difficultyDebugPanel';
            debugPanel.style.cssText = `
                position: fixed; 
                top: 50px; 
                right: 10px; 
                width: 300px; 
                background: white; 
                border: 2px solid #007bff; 
                border-radius: 8px; 
                padding: 15px; 
                box-shadow: 0 4px 12px rgba(0,0,0,0.15); 
                z-index: 10000; 
                font-family: Arial, sans-serif; 
                font-size: 12px;
                max-height: 400px;
                overflow-y: auto;
            `;
            
            debugPanel.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <h4 style="margin: 0; color: #007bff;">ğŸ”§ é›£åº¦åŒæ­¥èª¿è©¦</h4>
                    <button onclick="document.getElementById('difficultyDebugPanel').remove()" style="background: #dc3545; color: white; border: none; border-radius: 3px; padding: 2px 6px; cursor: pointer;">âœ•</button>
                </div>
                <div id="debugStatus" style="margin-bottom: 10px; font-size: 11px;"></div>
                <div style="margin-bottom: 10px;">
                    <button onclick="window.testDifficultySync('easy')" style="background: #6c757d; color: white; border: none; padding: 4px 8px; margin: 2px; border-radius: 3px; cursor: pointer;">æ¸¬è©¦ç°¡å–®</button>
                    <button onclick="window.testDifficultySync('medium')" style="background: #ffc107; color: black; border: none; padding: 4px 8px; margin: 2px; border-radius: 3px; cursor: pointer;">æ¸¬è©¦ä¸­ç­‰</button>
                    <button onclick="window.testDifficultySync('hard')" style="background: #dc3545; color: white; border: none; padding: 4px 8px; margin: 2px; border-radius: 3px; cursor: pointer;">æ¸¬è©¦å›°é›£</button>
                </div>
                <div style="margin-bottom: 10px;">
                    <button onclick="window.updateDebugStatus()" style="background: #17a2b8; color: white; border: none; padding: 4px 8px; margin: 2px; border-radius: 3px; cursor: pointer;">åˆ·æ–°ç‹€æ…‹</button>
                    <button onclick="window.simulateArduino('medium')" style="background: #28a745; color: white; border: none; padding: 4px 8px; margin: 2px; border-radius: 3px; cursor: pointer;">æ¨¡æ“¬Arduino</button>
                </div>
                <div style="margin-bottom: 10px;">
                    <h5 style="margin: 5px 0; font-size: 11px;">æ¨¡æ“¬ArduinoæŒ‡ä»¤:</h5>
                    <button onclick="window.simulateArduinoCommand('DIFFICULTY:EASY')" style="background: #6c757d; color: white; border: none; padding: 3px 6px; margin: 1px; border-radius: 2px; cursor: pointer; font-size: 10px;">ç°¡å–®</button>
                    <button onclick="window.simulateArduinoCommand('DIFFICULTY:MEDIUM')" style="background: #ffc107; color: black; border: none; padding: 3px 6px; margin: 1px; border-radius: 2px; cursor: pointer; font-size: 10px;">ä¸­ç­‰</button>
                    <button onclick="window.simulateArduinoCommand('DIFFICULTY:HARD')" style="background: #dc3545; color: white; border: none; padding: 3px 6px; margin: 1px; border-radius: 2px; cursor: pointer; font-size: 10px;">å›°é›£</button>
                </div>
                <div id="debugLog" style="background: #f8f9fa; padding: 8px; border-radius: 4px; font-family: monospace; font-size: 10px; max-height: 150px; overflow-y: auto;"></div>
            `;
            
            document.body.appendChild(debugPanel);
            window.updateDebugStatus();
        };
        
        window.updateDebugStatus = function() {
            const statusDiv = document.getElementById('debugStatus');
            if (!statusDiv) return;
            
            try {
                const hasRecipe = !!window.recipeGeneratorInstance;
                const difficulty = hasRecipe ? window.recipeGeneratorInstance.difficultyLevel : 'æœªçŸ¥';
                const hasArduino = !!window.arduinoServiceInstance;
                const arduinoConnected = hasArduino ? window.arduinoServiceInstance.connected : false;
                
                // æª¢æŸ¥æŒ‰éˆ•ç‹€æ…‹
                const easyActive = document.getElementById('easyBtn')?.classList.contains('active') || false;
                const mediumActive = document.getElementById('mediumBtn')?.classList.contains('active') || false;
                const hardActive = document.getElementById('hardBtn')?.classList.contains('active') || false;
                
                statusDiv.innerHTML = `
                    <div><strong>ç‹€æ…‹æª¢æŸ¥:</strong></div>
                    <div>ğŸ¯ ç•¶å‰é›£åº¦: <span style="color: #007bff; font-weight: bold;">${difficulty}</span></div>
                    <div>ğŸ”§ RecipeGenerator: ${hasRecipe ? 'âœ…' : 'âŒ'}</div>
                    <div>ğŸ”Œ Arduino: ${hasArduino ? (arduinoConnected ? 'âœ… å·²é€£æ¥' : 'âš ï¸ æœªé€£æ¥') : 'âŒ'}</div>
                    <div>æŒ‰éˆ•ç‹€æ…‹: ${easyActive ? 'ğŸŸ¢ç°¡å–®' : 'âšªç°¡å–®'} ${mediumActive ? 'ğŸŸ¡ä¸­ç­‰' : 'âšªä¸­ç­‰'} ${hardActive ? 'ğŸ”´å›°é›£' : 'âšªå›°é›£'}</div>
                `;
            } catch (error) {
                statusDiv.innerHTML = `<div style="color: red;">éŒ¯èª¤: ${error.message}</div>`;
            }
        };
        
        window.testDifficultySync = function(difficulty) {
            const logDiv = document.getElementById('debugLog');
            if (!logDiv) return;
            
            const timestamp = new Date().toLocaleTimeString();
            
            try {
                logDiv.innerHTML += `[${timestamp}] æ¸¬è©¦è¨­ç½®é›£åº¦: ${difficulty}\n`;
                
                if (!window.recipeGeneratorInstance) {
                    throw new Error('RecipeGenerator å¯¦ä¾‹ä¸å­˜åœ¨');
                }
                
                const beforeDifficulty = window.recipeGeneratorInstance.difficultyLevel;
                window.recipeGeneratorInstance.setDifficulty(difficulty);
                const afterDifficulty = window.recipeGeneratorInstance.difficultyLevel;
                
                logDiv.innerHTML += `[${timestamp}] é›£åº¦è®Šæ›´: ${beforeDifficulty} â†’ ${afterDifficulty}\n`;
                
                // æª¢æŸ¥æŒ‰éˆ•ç‹€æ…‹
                const btn = document.getElementById(difficulty + 'Btn');
                const isActive = btn ? btn.classList.contains('active') : false;
                logDiv.innerHTML += `[${timestamp}] æŒ‰éˆ•${difficulty}æ˜¯å¦æ´»å‹•: ${isActive}\n`;
                
                const success = afterDifficulty === difficulty && isActive;
                logDiv.innerHTML += `[${timestamp}] çµæœ: ${success ? 'âœ… æˆåŠŸ' : 'âŒ å¤±æ•—'}\n\n`;
                
                logDiv.scrollTop = logDiv.scrollHeight;
                window.updateDebugStatus();
                
            } catch (error) {
                logDiv.innerHTML += `[${timestamp}] âŒ éŒ¯èª¤: ${error.message}\n\n`;
                logDiv.scrollTop = logDiv.scrollHeight;
            }
        };
        
        window.simulateArduino = function(difficulty) {
            const logDiv = document.getElementById('debugLog');
            if (!logDiv) return;
            
            const timestamp = new Date().toLocaleTimeString();
            
            try {
                logDiv.innerHTML += `[${timestamp}] æ¨¡æ“¬Arduinoç™¼é€: DIFFICULTY:${difficulty}\n`;
                
                if (!window.arduinoServiceInstance) {
                    throw new Error('Arduino æœå‹™å¯¦ä¾‹ä¸å­˜åœ¨');
                }
                
                // ç›´æ¥èª¿ç”¨åŒæ­¥æ–¹æ³•
                window.arduinoServiceInstance.syncWebDifficulty(difficulty);
                
                logDiv.innerHTML += `[${timestamp}] ArduinoåŒæ­¥å®Œæˆ\n\n`;
                logDiv.scrollTop = logDiv.scrollHeight;
                
                setTimeout(() => {
                    window.updateDebugStatus();
                }, 100);
                
            } catch (error) {
                logDiv.innerHTML += `[${timestamp}] âŒ Arduinoæ¨¡æ“¬éŒ¯èª¤: ${error.message}\n\n`;
                logDiv.scrollTop = logDiv.scrollHeight;
            }
        };
        
        // æ¨¡æ“¬å®Œæ•´çš„ArduinoæŒ‡ä»¤è™•ç†æµç¨‹
        window.simulateArduinoCommand = function(command) {
            const logDiv = document.getElementById('debugLog');
            if (!logDiv) return;
            
            const timestamp = new Date().toLocaleTimeString();
            
            try {
                logDiv.innerHTML += `[${timestamp}] å®Œæ•´æ¨¡æ“¬ArduinoæŒ‡ä»¤: ${command}\n`;
                
                if (!window.arduinoServiceInstance) {
                    throw new Error('Arduino æœå‹™å¯¦ä¾‹ä¸å­˜åœ¨');
                }
                
                // æ¨¡æ“¬ Arduino ç™¼é€å®Œæ•´çš„æ•¸æ“šåŒ…
                window.arduinoServiceInstance.handleReceivedData(command + '\n');
                
                logDiv.innerHTML += `[${timestamp}] æŒ‡ä»¤è™•ç†å®Œæˆ\n\n`;
                logDiv.scrollTop = logDiv.scrollHeight;
                
                setTimeout(() => {
                    window.updateDebugStatus();
                }, 100);
                
            } catch (error) {
                logDiv.innerHTML += `[${timestamp}] âŒ æŒ‡ä»¤æ¨¡æ“¬éŒ¯èª¤: ${error.message}\n\n`;
                logDiv.scrollTop = logDiv.scrollHeight;
            }
        };
    </script>
</body>
</html>
